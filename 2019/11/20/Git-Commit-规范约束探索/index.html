<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="YoungSx"><title>git commit 规范约束探索 · 不懂鸟语的人</title><meta name="description" content="起因今天看到同事的 commit message 及其随意，我感到怀疑人生，明明很久以前就已经约定过 commit message 的格式问题，可还是变成了这个样子。于是我和朋友讨论了一下这件事和解决方案，感觉靠自觉还不如靠自动化检查。
找了些什么于是我去网上找了一下这方面的工具，找到了以下的解决方"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">不懂鸟语的人</a></h3><div class="description"><p>YoungSx 的个人学习笔记。精力原因，也许只为自己方便翻阅。</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/YangShangxin"><i class="fa fa-twitter"></i></a></li><li><a href="http://github.com/YoungSx"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>git commit 规范约束探索</a></h3></div><div class="post-content"><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>今天看到同事的 commit message 及其随意，我感到怀疑人生，明明很久以前就已经约定过 commit message 的格式问题，可还是变成了这个样子。<br>于是我和朋友讨论了一下这件事和解决方案，感觉靠自觉还不如靠自动化检查。</p>
<h2 id="找了些什么"><a href="#找了些什么" class="headerlink" title="找了些什么"></a>找了些什么</h2><p>于是我去网上找了一下这方面的工具，找到了以下的解决方案：</p>
<ul>
<li><p>commitizen</p>
</li>
<li><p>commitlint</p>
</li>
</ul>
<p>前者的方案是另起了一个 <code>git cz</code> 命令来进入commitizen 的使用流程，需要手动选择一个 commit type。</p>
<p>这样的操作略显繁琐，而且因为对原有 <code>git commit</code> 命令没有干扰，所以并不是很严格。而且在其他的 git GUI 工具中这个就不是很容易来利用这个了。</p>
<p>于是，我看了一下后者：commitlint，这个是利用了 husky 这个 git hook 工具，hook 了原有的 <code>git commit</code> 命令，对 commit 操作进行了拦截检查。</p>
<p>显然后者更符合我的需求。</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>依赖于 node/npm 环境，这个需要事现安装好。</p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>运行以下命令进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev @commitlint/cli @commitlint/config-conventional husky</div></pre></td></tr></table></figure>
<p>这行命令安装了三个包：</p>
<ul>
<li><p><code>@commitlint/cli</code>: commitlint 的 CLI 工具</p>
</li>
<li><p><code>@commitlint/config-conventional</code>: commitlint 的 conventional 规范配置方案，这是一个从 config-angular 衍生出的一个分支</p>
</li>
<li><p><code>husky</code>: 一款 git hook 工具，可以 hook git 的命令</p>
<p>补充：<br>​    <code>--save-dev</code> 参数表示将依赖写进 package.json 的 devDependencies 中，devDependencies 中的依赖只会在开发时安装，在部署时会被忽略。</p>
</li>
</ul>
<h3 id="Commitlint-配置"><a href="#Commitlint-配置" class="headerlink" title="Commitlint 配置"></a>Commitlint 配置</h3><p>项目根目录新建文件 commitlint.config.js 来存放 commitlint 的配置信息，写入以下内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  extends: [<span class="string">'@commitlint/config-conventional'</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>@commitlint/config-conventional</code> 是刚才安装的 commitlint 规范配置方案，可以安装并替换为其他的配置（例如 <code>config-angular</code>）。</p>
<h3 id="Husky-配置"><a href="#Husky-配置" class="headerlink" title="Husky 配置"></a>Husky 配置</h3><p>有两种配置方式</p>
<h3 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h3><p>在根目录的 package.json 加入以下配置信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"husky"</span>: &#123;</div><div class="line">    <span class="attr">"hooks"</span>: &#123;</div><div class="line">      <span class="attr">"commit-msg"</span>: <span class="string">"commitlint -E HUSKY_GIT_PARAMS"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><p>Husky 的版本 &gt;= 1.0.0</p>
<p>.huskyrc 或 .huskyrc.json 或者 .huskyrc.js 文件建在根目录，写入以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"hooks"</span>: &#123;</div><div class="line">    <span class="attr">"commit-msg"</span>: <span class="string">"commitlint -E HUSKY_GIT_PARAMS"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>另外看一下里面具体写了些什么：</p>
<p><code>commit-msg</code> 代表对 commit message 进行 hook，hook 的时候执行后面的命令 <code>commitlint -E HUSKY_GIT_PARAMS</code> 进行检查。</p>
<p>可以直接在命令行执行 <code>commitlint -h</code>  看一下 commitlint CLI 的具体用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@commitlint/cli@8.2.0 - Lint your commit messages</div><div class="line"></div><div class="line">[input] reads from stdin if --edit, --env, --from and --to are omitted</div><div class="line">--color, -c            toggle colored output, defaults to: true</div><div class="line">--config, -g           path to the config file</div><div class="line">--cwd, -d              directory to execute in, defaults to: D:\Projects\video_studio</div><div class="line">--edit, -e             read last commit message from the specified file or fallbacks to ./.git/COMMIT_EDITMSG</div><div class="line">--env, -E              check message in the file at path given by environment variable value</div><div class="line">--extends, -x          array of shareable configurations to extend</div><div class="line">--help, -h             display this help message</div><div class="line">--from, -f             lower end of the commit range to lint; applies if edit=false</div><div class="line">--format, -o           output format of the results</div><div class="line">--parser-preset, -p    configuration preset to use for conventional-commits-parser</div><div class="line">--quiet, -q            toggle console output</div><div class="line">--to, -t               upper end of the commit range to lint; applies if edit=false</div><div class="line">--version, -v          display version information</div><div class="line">--verbose, -V          enable verbose output for reports without problems</div></pre></td></tr></table></figure>
<p>这里用到的 <code>`commitlint -E</code> 是 <code>commitlint --env</code> 的简写。</p>
<h2 id="测试一下"><a href="#测试一下" class="headerlink" title="测试一下"></a>测试一下</h2><p>到此，部署完毕，可以试一下效果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add commitlint.config.js</div><div class="line">git commit -m <span class="string">"test"</span></div></pre></td></tr></table></figure>
<p>可以看到检查和报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">husky &gt; commit-msg (node v8.16.0)</div><div class="line">⧗   input: <span class="built_in">test</span></div><div class="line">✖   subject may not be empty [subject-empty]</div><div class="line">✖   <span class="built_in">type</span> may not be empty [<span class="built_in">type</span>-empty]</div><div class="line"></div><div class="line">✖   found 2 problems, 0 warnings</div><div class="line">ⓘ   Get <span class="built_in">help</span>: https://github.com/conventional-changelog/commitlint/<span class="comment">#what-is-commitlint</span></div><div class="line"></div><div class="line">husky &gt; commit-msg hook failed (add --no-verify to bypass)</div></pre></td></tr></table></figure>
<p>完毕~</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-11-20</span><i class="fa fa-tag"></i><a class="tag" href="/tags/工作/" title="工作">工作 </a><a class="tag" href="/tags/Git/" title="Git">Git </a><a class="tag" href="/tags/Node-js/" title="Node.js">Node.js </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2019/11/20/Git-Commit-规范约束探索/,不懂鸟语的人,git commit 规范约束探索,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/07/04/用-JS-把-Video-转为-Audio/" title="用 JS 把 Video 转为 Audio">下一篇</a></li></ul></div><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js?v=undefined"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:false || false, 
  verify:false|| false, 
  app_id:'b47PMHdzebB0ozGGdW68aQAN-gzGzoHsz',
  app_key:'pnCuygqUh5uDjQt8wNEKSd8K',
  placeholder:'Just go go',
  path: window.location.pathname,
  avatar:'mm'
})</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>